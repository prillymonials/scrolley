var CUSTOM_PROTOCOL_SCHEME='wvjbscheme';var QUEUE_HAS_MESSAGE='__WVJB_QUEUE_MESSAGE__';(function(){window.inBeeShop=function(){return window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf('beeshop')!=-1;};if(window.WebViewJavascriptBridge||!window||!window.navigator||!window.navigator.userAgent||window.navigator.userAgent.indexOf('Beeshop')==-1){return;}var messagingIframe;var sendMessageQueue=[];var receiveMessageQueue=[];var messageHandlers={};var responseCallbacks={};var uniqueId=1;function reset(){sendMessageQueue=[];receiveMessageQueue=[];messageHandlers={};responseCallbacks={};uniqueId=1;window.WebViewJavascriptBridge._messageHandler=null;}function _createQueueReadyIframe(doc){messagingIframe=doc.createElement('iframe');messagingIframe.style.display='none';messagingIframe.src=CUSTOM_PROTOCOL_SCHEME+'://'+QUEUE_HAS_MESSAGE;doc&&doc.documentElement&&doc.documentElement.appendChild(messagingIframe);}function init(messageHandler){if(window.WebViewJavascriptBridge._messageHandler){console.warn('WebViewJavascriptBridge.init called twice');return null;}window.WebViewJavascriptBridge._messageHandler=[messageHandler];var receivedMessages=receiveMessageQueue;receiveMessageQueue=null;setTimeout(function(){if(receivedMessages){for(var i=0;i<receivedMessages.length;i++){_dispatchMessageFromObjC(receivedMessages[i]);}}},0);}function send(data,responseCallback){_doSend({data:data},responseCallback);}function registerHandler(handlerName,handler,handlerId){if(typeof messageHandlers[handlerName]==='undefined'){messageHandlers[handlerName]={};}handlerId=handlerId||handler.toString();messageHandlers[handlerName][handlerId]=handler;hasHandlerCB(handlerName);}function unregisterHandler(handlerName,handlerId){if(!handlerId)return;var handler=messageHandlers[handlerName];if(!handler)return;delete handler[handlerId];var stillHasHandler=false;for(var _temp in handler){if(handler.hasOwnProperty(_temp)){stillHasHandler=true;break;}}if(!stillHasHandler){delete messageHandlers[handlerName];hasHandlerCB(handlerName);}}var hooks_map={};function addHook(hookFunc){var key=hookFunc.toString();if(hooks_map[key])return;hooks_map[key]=hookFunc;}function delHook(hookFunc){var key=hookFunc.toString();delete hooks_map[key];}function callHandler(handlerName,data,responseCallback){for(var k in hooks_map){if(!hooks_map.hasOwnProperty(k))continue;try{hooks_map[k](handlerName,data);}catch(ex){}}if(handlerName=='fullScreenImage'&&data){var imageUrls=data['imageUrls'];if(imageUrls&&imageUrls.length){try{for(var i=0;i<imageUrls.length;i++){var url=imageUrls[i];if(typeof url!=='string'||url.indexOf(window.ITEM_IMAGE_BASE_URL)<0)continue;imageUrls[i]=url.replace('/webp/','/');}}catch(e){}}}_doSend({handlerName:handlerName,data:data},responseCallback);}function _doSend(message,responseCallback){if(window.__appHasPendingCacheUpdate__)return;if(responseCallback){var callbackId='cb_'+uniqueId++ +'_'+ +new Date();responseCallbacks[callbackId]=responseCallback;message['callbackId']=callbackId;}if(window.navigator.userAgent.toLowerCase().indexOf('android')==-1){sendMessageQueue.push(message);messagingIframe.src=CUSTOM_PROTOCOL_SCHEME+'://'+QUEUE_HAS_MESSAGE;}else{window.gabridge.sendMsg(JSON.stringify(message));}}function _fetchQueue(){var messageQueueString=JSON.stringify(sendMessageQueue);sendMessageQueue=[];return messageQueueString;}function _dispatchMessageFromObjC(messageJSON){if(window.__appHasPendingCacheUpdate__)return;try{var message=JSON.parse(messageJSON);}catch(err){var message={};console.warn('Bridge dispatch failed. err = '+err);}var messageHandler;if(message.responseId){var responseCallback=responseCallbacks[message.responseId];if(!responseCallback){return;}responseCallback(message.responseData);delete responseCallbacks[message.responseId];}else{var responseCallback;if(message.callbackId){var callbackResponseId=message.callbackId;responseCallback=function responseCallback(responseData){_doSend({responseId:callbackResponseId,responseData:responseData});};}var handler=window.WebViewJavascriptBridge._messageHandler;if(message.handlerName){handler=messageHandlers[message.handlerName];}if(typeof handler==='undefined')return;for(var k in handler){if(!handler.hasOwnProperty(k))continue;try{handler[k](message.data,responseCallback);}catch(exception){if(typeof console!=='undefined'){console.log('WebViewJavascriptBridge: WARNING: javascript handler threw.',message,exception);}}}}}function _handleMessageFromObjC(messageJSON){if(receiveMessageQueue){receiveMessageQueue.push(messageJSON);}else{_dispatchMessageFromObjC(messageJSON);}}function hasHandler(handlerName){var has=false;try{has=null!=messageHandlers[handlerName];}catch(exception){has=false;}return has?'true':'false';}function hasHandlerCB(handlerName){if(!window.gabridge)return;window.gabridge.onHasHandler(handlerName,hasHandler(handlerName));}function appHasHandler(name){return window.WebViewJavascriptBridge._appHandlers&&window.WebViewJavascriptBridge._appHandlers.indexOf(name)>=0;}window.WebViewJavascriptBridge={init:init,send:send,registerHandler:registerHandler,unregisterHandler:unregisterHandler,callHandler:callHandler,hasHandler:hasHandler,hasHandlerCB:hasHandlerCB,addHook:addHook,delHook:delHook,appHasHandler:appHasHandler,_fetchQueue:_fetchQueue,_handleMessageFromObjC:_handleMessageFromObjC,reset:reset};var doc=document;_createQueueReadyIframe(doc);var readyEvent=doc.createEvent('Events');readyEvent.initEvent('WebViewJavascriptBridgeReady');readyEvent.bridge=window.WebViewJavascriptBridge;doc.dispatchEvent(readyEvent);var timerTriggerIOS=null;var intervalTriggerIOS=null;})();window.connectWebViewJavascriptBridge=function(callback){if(window.WebViewJavascriptBridge){callback(window.WebViewJavascriptBridge);}else{document.addEventListener('WebViewJavascriptBridgeReady',function(){if(dismissNonShopeeBridge())return;callback(window.WebViewJavascriptBridge);},false);}};